{% load static %}
<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Игра — {{ game.title }}</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css">
  <style>
    body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f7f7f7}
    .container{max-width:1100px;margin:0 auto;padding:16px}
    .play-row{display:flex;gap:18px;align-items:flex-start;justify-content:center}
    .play-left{flex:0 0 720px;max-width:72vw}
    .play-right{flex:1;min-width:320px;max-width:40vw}
    .video-wrap{background:#000;padding-top:56.25%;position:relative}
    .video-wrap iframe{position:absolute;top:0;left:0;width:100%;height:100%;border:0}
    .video-wrap .video-overlay{position:absolute;top:0;left:0;width:100%;height:100%;display:none;z-index:2;background:transparent;cursor:default}
    .video-wrap{min-height:180px}
    .answer-area{position:relative;z-index:5;background:#fff;padding:12px;border-radius:6px;box-shadow:0 2px 6px rgba(0,0,0,.08)}
    .video-wrap{z-index:0}
    .question-text{font-size:18px;margin-bottom:8px}
    .options{display:flex;flex-wrap:wrap;gap:8px;margin-bottom:8px}
    .options button{padding:8px 12px;border:1px solid #ddd;background:#fafafa;border-radius:4px;cursor:pointer}
    .options button.selected{background:#dff0d8;border-color:#6abf69}
    .bet-btn{padding:6px 10px;margin-right:6px;border:1px solid #cfcfcf;background:#f5f7fa;border-radius:4px}
    .bet-btn.selected{background:#dff0d8;border-color:#6abf69}
    .options button.disabled{opacity:.5;cursor:not-allowed}
    .bet {margin-top:8px}
    .countdown{font-weight:bold;margin-left:8px}
    .hidden{display:none}
    @media (max-width:1000px){
      .play-row{flex-direction:column}
      .play-left,.play-right{max-width:100%;flex:unset}
      .answer-area{margin-top:12px}
    }
    @media (orientation:landscape) and (max-width:900px){
      .play-row{flex-direction:row}
      .play-left{flex:0 0 55%}
      .play-right{flex:1;min-width:40%}
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>{{ game.title }}</h1>

    <div class="play-row">
      <div class="play-left">
        <div class="video-wrap" id="video">
      <!-- Use per-game embed HTML or URL if provided. If admin pasted full <iframe> markup,
           render it raw (safe). Otherwise treat value as a src URL. -->
      {% if game.video_url %}
        {% if '<iframe' in game.video_url %}
          {{ game.video_url|safe }}
        {% else %}
          <iframe src="{{ game.video_url }}" allowfullscreen title="Видео"></iframe>
          <div id="video-overlay" class="video-overlay" aria-hidden="true"></div>
        {% endif %}
      {% else %}
          <iframe src="https://www.youtube.com/embed/dQw4w9WgXcQ" allowfullscreen title="Видео"></iframe>
          <div id="video-overlay" class="video-overlay" aria-hidden="true"></div>
      {% endif %}
        </div>
      </div>

      <div class="play-right">
        <div class="answer-area" id="answer-area">
      <div class="meta">Подключение к WebSocket: <span id="ws-status">...</span></div>

      <!-- Контейнер для нескольких вопросов раунда -->
      <div id="questions-container"></div>

      <div id="no-question">Ожидание вопроса...</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    window.PLAY_CONFIG = {
      ws_url: '{{ ws_url }}',
      participant_id: '{{ participant_id|default_if_none:"" }}',
    };
  </script>
  <script src="{% static 'quiz/js/play.js' %}"></script>
</body>
</html>
